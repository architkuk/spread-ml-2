{% extends "base.html" %}

{% block content %}
<div class="welcome">
    <h2>Welcome to SpreadML, {{ current_user.username }}!</h2>
    <p>Your intelligent spreadsheet with built-in machine learning capabilities.</p>
    
    <div class="dashboard-tabs">
        <div class="tab-headers">
            <button class="tab-btn active" data-tab="spreadsheets">Spreadsheets</button>
            <button class="tab-btn" data-tab="models">Models</button>
        </div>
        
        <div id="spreadsheets" class="tab-content active">
            <h3>Your Spreadsheets</h3>
            <div class="action-btn">
                <button id="create-sheet">New Spreadsheet</button>
                <button id="upload-csv">Upload CSV</button>
            </div>
            <div class="item-list">
                {% if spreadsheets %}
                    <div class="spreadsheet-grid">
                        {% for sheet in spreadsheets %}
                        <div class="spreadsheet-card">
                            <h4>{{ sheet.name }}</h4>
                            <p>Last updated: {{ sheet.updated_at.strftime('%Y-%m-%d %H:%M') }}</p>
                            <a href="{{ url_for('spreadsheet.edit', id=sheet.id) }}" class="btn-open">Open</a>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p>No spreadsheets yet. Create one to get started!</p>
                {% endif %}
            </div>
        </div>
        
        <div id="models" class="tab-content">
            <h3>Your Models</h3>
            <div class="item-list">
                <p>No models yet. Create a spreadsheet and train a model to get started!</p>
            </div>
        </div>
    </div>
</div>

<!-- New Spreadsheet Modal -->
<div id="new-spreadsheet-modal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Create New Spreadsheet</h2>
        <form id="new-spreadsheet-form" method="POST" action="{{ url_for('spreadsheet.create') }}">
            <div class="form-group">
                <label for="spreadsheet_name">Spreadsheet Name</label>
                <input type="text" id="spreadsheet_name" name="spreadsheet_name" required>
            </div>
            <div class="form-group">
                <button type="submit">Create</button>
                <button type="button" class="btn-cancel">Cancel</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Tab switching functionality
        const tabBtns = document.querySelectorAll('.tab-btn');
        tabBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                // Remove active class from all buttons and content
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // Add active class to current button and corresponding content
                this.classList.add('active');
                document.getElementById(this.dataset.tab).classList.add('active');
            });
        });
        
        // Modal functionality
        const modal = document.getElementById('new-spreadsheet-modal');
        const createBtn = document.getElementById('create-sheet');
        const closeBtn = modal.querySelector('.close');
        const cancelBtn = modal.querySelector('.btn-cancel');
        
        createBtn.addEventListener('click', function() {
            modal.style.display = 'block';
        });
        
        closeBtn.addEventListener('click', function() {
            modal.style.display = 'none';
        });
        
        cancelBtn.addEventListener('click', function() {
            modal.style.display = 'none';
        });
        
        // Close modal when clicking outside of it
        window.addEventListener('click', function(event) {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        });
    });
</script>
{% endblock %} 